{% extends "parties/base.html" %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    
    <div style="margin-bottom: 30px;">
        <h2 style="margin: 0;">ğŸ”­ íŒŒí‹° ì°¾ê¸°</h2>
        <p style="color: var(--muted); margin-top: 5px;">ì›í•˜ëŠ” íŒŒí‹°ë¥¼ ì°¾ì•„ë³´ê±°ë‚˜ ì§ì ‘ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>
    </div>

    <div class="grid" id="party-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
        
        <a href="{% url 'party_create' %}" class="card" style="
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            text-decoration: none; 
            border: 2px dashed var(--border); 
            background: rgba(255,255,255,0.02); 
            color: var(--muted); 
            transition: all 0.2s ease;
            min-height: 250px; /* ë‹¤ë¥¸ ì¹´ë“œë“¤ê³¼ ë†’ì´ ë§ì¶¤ */
        " onmouseover="this.style.borderColor='var(--primary)'; this.style.color='var(--primary)';" 
          onmouseout="this.style.borderColor='var(--border)'; this.style.color='var(--muted)';">
            
            <div style="font-size: 40px; margin-bottom: 15px;">â•</div>
            <h3 style="margin: 0; font-size: 1.2rem;">ìƒˆ íŒŒí‹° ë§Œë“¤ê¸°</h3>
            <p style="font-size: 0.9rem; margin-top: 5px;">ë‚´ê°€ ì›í•˜ëŠ” ê²Œì„ì„ ëª¨ì§‘í•´ë³´ì„¸ìš”!</p>
        </a>

        {% for party in parties %}
        <div class="card" style="position: relative; padding: 20px; border: 1px solid var(--border); border-radius: 12px; background: var(--surface);">
            
            <a href="{% url 'party_detail' party.pk %}" style="text-decoration: none; color: inherit; display: block;">
                <span class="pill" style="background: var(--primary); color: white; padding: 4px 10px; border-radius: 15px; font-size: 12px;">{{ party.game.name }}</span>
                <h3 style="margin: 15px 0 10px;">{{ party.title }}</h3>
                <p style="color: var(--muted); font-size: 0.9rem; line-height: 1.5; min-height: 40px;">
                    {{ party.description|truncatechars:50|default:"ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤." }}
                </p>
                
                <div style="margin-top: 15px; font-weight: bold; display: flex; align-items: center; gap: 5px;">
                    <span>ğŸ‘¥</span> 
                    <span>{{ party.current_member_count }} / {{ party.max_members }}</span>
                </div>
            </a>

            <div class="card-footer" style="margin-top: 20px; border-top: 1px solid var(--border); padding-top: 15px;">
                
                {% if user == party.host or user in party.members.all %}
                    <a href="{% url 'party_detail' party.pk %}" class="btn" style="width: 100%; display: block; text-align: center; background: var(--surface-hover); border: 1px solid var(--border);">
                        ğŸš€ ì±„íŒ…ë°© ì…ì¥
                    </a>

                {% elif party.current_member_count < party.max_members %}
                    <form action="{% url 'party_join' party.pk %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            âš¡ï¸ ë°”ë¡œ ì°¸ì—¬í•˜ê¸°
                        </button>
                    </form>

                {% else %}
                    <button class="btn" disabled style="width: 100%; background: #eee; color: #999; cursor: not-allowed;">
                        â›”ï¸ ëª¨ì§‘ ë§ˆê°
                    </button>
                {% endif %}
                
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}